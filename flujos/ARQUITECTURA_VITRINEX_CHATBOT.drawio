<mxfile host="65bd71144e">
    <diagram name="Arquitectura Vitrinex" id="vitrinex-architecture">
        <mxGraphModel dx="1341" dy="926" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="850" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="VITRINEX - Arquitectura del Sistema de Chatbot" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="400" y="20" width="600" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="layer1" value="CAPA DE PRESENTACIÃ“N" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="100" y="100" width="1200" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="browser" value="&lt;b&gt;Navegador Web&lt;/b&gt;&lt;br&gt;Chrome / Firefox / Safari&lt;br&gt;Edge / Opera" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="150" y="140" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="react" value="&lt;b&gt;Frontend React&lt;/b&gt;&lt;br&gt;Vite + TailwindCSS&lt;br&gt;Axios + React Router" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
                    <mxGeometry x="400" y="140" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="chatbot-widget" value="&lt;b&gt;ChatbotWidget&lt;/b&gt;&lt;br&gt;Widget Flotante&lt;br&gt;FREE / PREMIUM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="650" y="140" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="admin-monitor" value="&lt;b&gt;Admin Monitor&lt;/b&gt;&lt;br&gt;Dashboard EstadÃ­sticas&lt;br&gt;GrÃ¡ficos Recharts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
                    <mxGeometry x="900" y="140" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="browser" target="react" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="react" target="chatbot-widget" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="react" target="admin-monitor" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="layer2" value="CAPA DE APLICACIÃ“N (API REST)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="100" y="280" width="1200" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="express" value="&lt;b&gt;Express.js Server&lt;/b&gt;&lt;br&gt;Node.js v22&lt;br&gt;Port 4000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="150" y="330" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="routes" value="&lt;b&gt;Routes&lt;/b&gt;&lt;br&gt;/api/chatbot&lt;br&gt;/api/chatbot/premium&lt;br&gt;/api/chatbot/health&lt;br&gt;/api/chatbot/stats" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
                    <mxGeometry x="370" y="320" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="controllers" value="&lt;b&gt;Controllers&lt;/b&gt;&lt;br&gt;chatbot.controller.js&lt;br&gt;- sendChatMessage&lt;br&gt;- sendPremiumChatMessage&lt;br&gt;- getChatbotStats" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" parent="1" vertex="1">
                    <mxGeometry x="610" y="320" width="220" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="middleware" value="&lt;b&gt;Middleware&lt;/b&gt;&lt;br&gt;authRequired&lt;br&gt;VerificaciÃ³n JWT&lt;br&gt;ValidaciÃ³n Plan" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
                    <mxGeometry x="870" y="330" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="ai-client" value="&lt;b&gt;AI Client&lt;/b&gt;&lt;br&gt;aiClient.js&lt;br&gt;- getChatbotResponse (FREE)&lt;br&gt;- getChatbotResponsePremium" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;" parent="1" vertex="1">
                    <mxGeometry x="1080" y="320" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#82b366;" parent="1" source="chatbot-widget" target="express" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="750" y="250"/>
                            <mxPoint x="240" y="250"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow4-label" value="HTTP/HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow4" vertex="1" connectable="0">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="express" target="routes" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="routes" target="controllers" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#b85450;strokeWidth=2;" parent="1" source="routes" target="middleware" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="590" y="360"/>
                            <mxPoint x="960" y="360"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow7-label" value="Premium Only" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow7" vertex="1" connectable="0">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="controllers" target="ai-client" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="layer3" value="SERVICIOS EXTERNOS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="100" y="540" width="600" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="openai" value="&lt;b&gt;OpenAI API&lt;/b&gt;&lt;br&gt;GPT-4o-mini&lt;br&gt;$0.15 / $0.60 per 1M tokens&lt;br&gt;Mode: AI / DEMO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="150" y="590" width="220" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="demo-mode" value="&lt;b&gt;Modo DEMO&lt;/b&gt;&lt;br&gt;Respuestas Predefinidas&lt;br&gt;Sin costo&lt;br&gt;Fallback automÃ¡tico" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="420" y="590" width="220" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="layer4" value="CAPA DE PERSISTENCIA" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="750" y="530" width="590" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="mongodb" value="&lt;b&gt;MongoDB Atlas&lt;/b&gt;&lt;br&gt;Base de datos NoSQL&lt;br&gt;Cloud Hosted" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;shadow=1;" parent="1" vertex="1">
                    <mxGeometry x="800" y="590" width="180" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="models" value="&lt;b&gt;Modelos&lt;/b&gt;&lt;br&gt;â€¢ User (plan)&lt;br&gt;â€¢ Store&lt;br&gt;â€¢ Product&lt;br&gt;â€¢ Order&lt;br&gt;â€¢ Booking&lt;br&gt;â€¢ ChatbotUsage&lt;br&gt;â€¢ Message" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" parent="1" vertex="1">
                    <mxGeometry x="1050" y="560" width="230" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#82b366;" parent="1" source="ai-client" target="openai" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1180" y="520"/>
                            <mxPoint x="260" y="520"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow9-label" value="API Call (HTTPS)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow9" vertex="1" connectable="0">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#d6b656;dashed=1;" parent="1" source="ai-client" target="demo-mode" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1180" y="510"/>
                            <mxPoint x="530" y="510"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow10-label" value="Fallback" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow10" vertex="1" connectable="0">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#6c8ebf;" parent="1" source="controllers" target="mongodb" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="720" y="450"/>
                            <mxPoint x="720" y="500"/>
                            <mxPoint x="890" y="500"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow11-label" value="Mongoose ODM" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="arrow11" vertex="1" connectable="0">
                    <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="arrow12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="mongodb" target="models" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="100" y="740" width="1200" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="legend-title" value="LEYENDA Y FLUJOS" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="120" y="750" width="200" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="legend-free" value="&lt;b&gt;PLAN FREE:&lt;/b&gt; Usuario â†’ Frontend â†’ /api/chatbot â†’ Controller â†’ AI Client â†’ OpenAI/DEMO â†’ Respuesta genÃ©rica" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="120" y="775" width="1000" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="legend-premium" value="&lt;b&gt;PLAN PREMIUM:&lt;/b&gt; Usuario â†’ Frontend â†’ /api/chatbot/premium â†’ authRequired â†’ Controller â†’ MongoDB (datos) â†’ AI Client â†’ OpenAI â†’ AnÃ¡lisis personalizado + Guardar estadÃ­sticas" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="120" y="795" width="1150" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="note1" value="ðŸ”’ Protegido con JWT" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="870" y="400" width="180" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="note2" value="ðŸ’° Costo: ~$0.0006 por consulta" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="150" y="680" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="note3" value="ðŸ†“ Gratis - Sin lÃ­mites" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="420" y="680" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="note4" value="ðŸ“Š Tracking automÃ¡tico de tokens y costos" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1050" y="700" width="230" height="30" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>